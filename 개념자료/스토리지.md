## 스토리지

### 쿠키

: 웹사이트에 로그인하면, 서버는 클라이언트에게 인증 정보를 담은 쿠키를 발급한다. 이후 클라이언트는 서버에 요청을 보낼 때마다 이 쿠키를 자동으로 함께 보내, 로그인된 상태임을 서버에 알린다. <br />

로그인에 성공했을 때 서버가 Set-Cookie 헤더로 쿠키 값을 보내주면, 이걸 클라이언트가 저장해 두었다가, 서버에 리퀘스트를 보낼 때마다 매번 Cookie 헤더로 보내서 로그인 된 상태라는걸 표시한다. 쿠키는 수명이 정해져 있다면 브라우저를 껐다 켜도 유지되며, 일정 기간 동안 로그인 상태를 유지할 수 있다. <br />

#### 특징

1. 서버로부터 리스폰스로 쿠키를 받으면, 클라이언트에서는 별도로 작업을 해주지 않아도 웹 브라우저가 알아서 저장하고 리퀘스트를 보낼 때도 웹 브라우저가 알아서 보냄
2. 자바스크립트를 통해서 쿠키 값을 추가, 수정, 참조할 수 있음
3. 수명을 지정할 수 있음. 수명이 다한 쿠키는 알아서 지워짐
4. 일반적으로 쿠키 하나당 최대 크기는 약 4KB이며, 하나의 도메인당 저장할 수 있는 쿠키 개수에도 제한이 있음 (대략 20개)

#### 알아두면 좋은 Attribute

- Domain
  : 브라우저가 쿠키를 보낼 도메인을 지정 <br />
  예를들어, Domain=hello.kr 이라고 하면 `https://hello.kr`은 물론이고 `https://abc.hello.kr` , `https://xyz.abc.hello.kr` 같은 서브 도메인에 리퀘스트를 할 때도 쿠키를 보냄

- Path
  : 브라우저가 쿠키를 보낼 경로를 지정. <br />
  예를들어, Path=/ 라고 하면, / 아래에 있는 경로들 (/abc, /abc/xyz) 에 리퀘스트를 보낼 때에도 모두 쿠키를 보냄 <br />
  Domain=hello.kr, Path=/user일 때, `https://abc.hello.kr/user/profile`로 요청을 보내면 쿠키가 전송됨.

- HttpOnly
  : 쿠키를 자바스크립트로 (`document.cookie`) 접근할 수 없도록 설정해서, XSS (크로스사이트스크립팅) 공격을 막는 데 유용함 <br />

  `XSS` ? 웹사이트에 악성 스크립트를 삽입하여 다른 사용자의 브라우저에서 실행되도록 만드는 공격 방식. 특히 사용자의 쿠키, 세션, 로그인 정보 등을 탈취하거나, 사용자를 피싱 사이트로 유도하는 데 자주 활용됨.

- SameSite
  : XSRF를 방지하기 위해서 제 3자 사이트(Third-party site)에서 쿠키를 보내지 못하게 SameSite를 지정해야함 <br />
  상황예시 <br />

  1. 사용자 A는 평소처럼 hello.kr에 로그인함. 이때 sessionId=abc123 쿠키가 저장됨.

  2. 몇 시간 뒤, A는 광고로 뜬 hacker-site.com에 방문함.

  3. 그 사이트에는 보이지 않는 다음과 같은 코드를 심어둠:

  ```html
  <img src="https://hello.kr/user/delete-account" />
  ```

  4. A가 hacker 사이트에 들어가는 순간, 브라우저는 저 이미지를 "보려고" 요청을 보냄.

  5. 브라우저는 쿠키가 있는 도메인으로 리퀘스트를 보내면 쿠키를 자동으로 함께 전송함 (쿠키가 알아서 붙어서 감) → hello.kr로 요청이 가니까 sessionId=abc123도 같이 감!

  6. 결과적으로 A는 본인도 모르게 계정을 삭제당함.

  이게 바로 CSRF (XSRF).
  **"로그인된 인증 정보를 이용해서 제3의 웹사이트가 악의적인 요청을 하게 만드는 공격"**

  SameSite 옵션에는 Strict, Lax, None이 있음. SameSite = "옵션" 이런식으로 쓰면 됨 (SameSite = Lax; , SameSite = Strict; 이런식) <br />

  | 옵션   | 설명                                                                             | 쿠키 전송 여부    |
  | ------ | -------------------------------------------------------------------------------- | ----------------- |
  | Strict | 다른 사이트에서 온 **모든 요청에 대해 쿠키 전송을 차단**                         | ❌ 전송 안 함     |
  | Lax    | **GET 요청**에 한해 쿠키 전송 허용 (링크 클릭, 북마크 등 안전한 요청만 허용)     | 🔸 일부 전송 허용 |
  | None   | **모든 요청**에 대해 쿠키 전송 허용. 단, 반드시 `Secure`(HTTPS) 옵션이 있어야 함 | ✅ 항상 전송      |

  | 상황                                                     | Strict 쿠키 전송 | Lax 쿠키 전송 | None 쿠키 전송 |
  | -------------------------------------------------------- | ---------------- | ------------- | -------------- |
  | 사용자가 주소창에 `hello.kr/profile` 직접 입력           | ✅ 전송됨        | ✅ 전송됨     | ✅ 전송됨      |
  | 이메일 링크 클릭으로 `hello.kr/welcome` GET 요청         | ❌ 전송 안 됨    | ✅ 전송됨     | ✅ 전송됨      |
  | 다른 사이트에서 `<img src="https://hello.kr/view">` 요청 | ❌ 전송 안 됨    | ✅ 전송됨     | ✅ 전송됨      |
  | 다른 사이트에서 `<form method="POST">`로 요청 보낼 경우  | ❌ 전송 안 됨    | ❌ 전송 안 됨 | ✅ 전송됨      |

  💡 요약 정리 <br />

  - CSRF는 "내 쿠키를 악성 사이트가 써먹는 공격"

  - SameSite=Strict: 다른 사이트에서 오면 "넌 내 쿠키 못 써"

  - SameSite=Lax: 안전한 건 괜찮아(GET 요청), 위험한 건 안 돼(POST 등)

  - SameSite=None: 뭐든 다 보내, 하지만 HTTPS여야 해 (Secure 필수, 최신 브라우저들은 Secure가 없으면 쿠키가 저장이 안됨.)

- Secure
  : Secure를 지정하면 HTTPS 리퀘스트를 보낼 때만 쿠키를 보냄. SameSite=None을 지정하면 반드시 Secure도 함께 지정해야함.

  #### `HTTP` vs `HTTPS`

  | 항목        | HTTP                                   | HTTPS                                             |
  | ----------- | -------------------------------------- | ------------------------------------------------- |
  | 전송 방식   | **평문(암호화 없음)**                  | **암호화(SSL/TLS로 암호화됨)**                    |
  | 보안성      | 낮음 – 중간에서 **패킷 가로채기 가능** | 높음 – **패킷을 가로채도 내용 해독 불가**         |
  | 포트 번호   | 80번                                   | 443번                                             |
  | 사용 사례   | 예전에는 기본, 현재는 거의 쓰이지 않음 | 현재 대부분의 웹사이트 기본 (Chrome도 HTTPS 권장) |
  | 인증서 필요 | ❌ 인증서 필요 없음                    | ✅ SSL 인증서 필요                                |
  | URL 형태    | `http://example.com`                   | `https://example.com`                             |

- Expires, Max-Age
  : 쿠키의 수명을 지정하는 속성. <br />
  Expires로 만료될 시기를 지정하거나, Max-Age 로 쿠키의 수명을 지정할 수 있음. <br />
  세션 쿠키(Session Cookie)는 Expires 나 Max-Age 를 지정하지 않으면 자동으로 생성되며, 브라우저를 닫으면 삭제된다. <br />
  영속적인 쿠키 (Persistent Cookie) 는 Expires 나 Max-Age 로 수명을 지정해서 만들 수 있음. 수명이 다하면 지워지는 쿠키. <br />

- 참고하면 좋은 자료

  쿠키, 세션, 캐시가 뭔가요? <br />
  https://www.youtube.com/watch?v=OpoVuwxGRDI <br />

  HTTP 쿠키 - HTTP | MDN <br />
  https://developer.mozilla.org/ko/docs/Web/HTTP/Guides/Cookies <br />

  Set-Cookie - HTTP | MDN <br />
  https://developer.mozilla.org/ko/docs/Web/HTTP/Reference/Headers/Set-Cookie <br />

  react-cookie 쉽게 사용하기 <br />
  https://blog.pumpkin-raccoon.com/80 <br />

### 세션 스토리지, 로컬 스토리지

쿠키는 서버에서 만들고, 클라이언트는 거의 건드리지 않음. 그런데, 사이트에 따라서 클라이언트에서만 사용하는 데이터인데, 저장해놓고 사용하고 싶은 경우가 있음. 이런 목적으로 나온게 스토리지. <br />
스토리지가 변경될 때 'storage' 라는 이벤트가 발생

#### `세션 스토리지`

- 현재 탭에서만 유효한 저장소
- 탭을 닫으면 데이터가 사라짐
- 다른 탭과 데이터가 공유되지 않음

#### 사용하는 프로퍼티

1. setItem : 값을 저장

```javascript
const data = inputElement.value;
sessionStorage.setItem("draft", data);
```

2. getItem : 값을 참조

```javascript
const draftData = sessionStorage.getItem("draft");
```

3. removeItem : 값 지우기

```javascript
sessionStorage.removeItem("draft");
```

#### `로컬 스토리지`

- 해당 사이트에서 유효한 저장소
- 탭을 닫거나 브라우저를 닫아도 데이터가 유지됨
- 여러 탭 사이에서도 데이터가 공유됨

#### 쿠키 VS 로컬/세션 스토리지

## 🍪 쿠키 vs 🗄️ 로컬/세션 스토리지 비교

| 구분           | 쿠키 (Cookie)                                               | 로컬 스토리지 (LocalStorage)                               | 세션 스토리지 (SessionStorage)                           |
| -------------- | ----------------------------------------------------------- | ---------------------------------------------------------- | -------------------------------------------------------- |
| 저장 위치      | 클라이언트 브라우저 (자동으로 서버에 전송됨)                | 클라이언트 브라우저                                        | 클라이언트 브라우저                                      |
| 생성 주체      | 서버 또는 클라이언트 (자바스크립트)                         | 클라이언트 (자바스크립트)                                  | 클라이언트 (자바스크립트)                                |
| 저장 용량      | 약 4KB (도메인당 제한 있음)                                 | 약 5~10MB (브라우저별 상이)                                | 약 5~10MB (브라우저별 상이)                              |
| 만료 시점      | 설정 가능 (`Expires`, `Max-Age`) 없으면 세션 쿠키           | 수동 삭제 전까지 영구 저장                                 | 탭 or 브라우저 종료 시 삭제                              |
| 서버 자동 전송 | ✅ (매 요청마다 `Cookie` 헤더에 포함됨)                     | ❌                                                         | ❌                                                       |
| 보안 속성 설정 | ✅ (`Secure`, `HttpOnly`, `SameSite` 등)                    | ❌                                                         | ❌                                                       |
| 사용 목적      | 인증, 세션 유지 (ex. 로그인 상태)                           | 장기적인 클라이언트 데이터 저장                            | 일시적인 세션 단위 데이터 저장                           |
| 접근 방법      | `document.cookie` (복잡함)                                  | `localStorage.getItem/setItem()` 등                        | `sessionStorage.getItem/setItem()` 등                    |
| 사용 예시      | 하루 동안 보지 않기 팝업, 비회원 장바구니, 로그인 상태 유지 | 다크/라이트 모드, 최근 검색어, 언어/폰트 설정, 입력값 보존 | 탭 독립 추천 영상, 설문 진행상태, 새로고침용 임시 데이터 |

의문 : 아니 쿠키로 만든거 로컬 스토리지로도 충분히 만들 수 있는거 아닌가 ? <br />

해결 : 쿠키는 서버와 자동 통신이 필요할 때 쓰고, 인증에 적합하다. <br />
로컬스토리지는 브라우저 전용 상태 저장이 필요할 때 쓰고, 인증에는 부적합하다.

🍪 쿠키를 써야 하는 경우 – 서버와 자동 통신 <br />

| 사용 예시               | 이유                                                            |
| ----------------------- | --------------------------------------------------------------- |
| 로그인 상태 유지        | 요청마다 쿠키가 서버에 **자동 전송**되므로 로그인 인증이 가능함 |
| 비회원 장바구니         | 서버에서 장바구니 상태를 유지하거나 상품과 연동해야 할 수 있음  |
| 하루동안 보지 않기 팝업 | 서버에서 "이 사용자 팝업 봤음"을 판단할 수 있도록 **전달 필요** |

🗄️ 로컬스토리지를 쓰는 게 맞는 경우 – 브라우저 전용 상태 저장

| 사용 예시             | 이유                                                              |
| --------------------- | ----------------------------------------------------------------- |
| 다크/라이트 모드 설정 | UI 상태만 조정하면 되므로 서버와의 통신 불필요                    |
| 최근 검색어           | 개인 브라우저에만 저장하면 됨. 서버에 전송할 필요 없음            |
| 언어, 폰트 설정       | 클라이언트 단에서만 사용되므로 서버 관여 없음                     |
| 입력값 보존           | 실수로 창 닫았을 때 복원용. 서버와 관련 없는 **UX 개선용 데이터** |

### `참고하면 좋은 자료`

Web Storage API - Web API | MDN <br />
https://developer.mozilla.org/ko/docs/Web/API/Web_Storage_API <br />

웹용 스토리지 <br />
https://web.dev/articles/storage-for-the-web?hl=ko <br />

localStorage와 sessionStorage <br />
https://ko.javascript.info/localstorage <br />
